---
{"tag":[["리팩터링"]],"dg-publish":true,"date created":"수요일, 12월 21일 2022, 10:02:27 오후","date modified":"화요일, 12월 27일 2022, 11:01:38 오후","created":"2022-12-27T23:02:08+09:00","updated":"2022-12-27T23:03:54+09:00","permalink":"/4_IT/리팩터링/20221012/","dgPassFrontmatter":true,"noteIcon":""}
---


슬랙 알림으로 broken pipe가 자주 나오는 건이 있어 요즘 여유가 생긴터라 감사로그로 확인 후 소스를 확인해보니 동일한 로직을 두번 호출하는 API를 확인하였다.

broken pipe 오류는 어디서 오류 났다고 나오지 않았기에 이것도 심증이긴한데 오류 날때마다 감사로그를 확인했으니 꽤 근접했으리라 본다.

첫번째 로직으로 객체의 사이즈를 가져오고 해당 쿼리를 또 호출을 한 후에 페이지 크기를 첫번째 객체의 결과값이였던 사이즈로 가공하는 형태로 구현이 되어있었다.

왜 저렇게 짰을까 생각했지만 여튼 그거 알아서 해결되는 것은 아니기에  호출을 한번만 하게 하고 리턴할 때 호출한 객체의 사이즈를 넣는 것으로 해결

무겁게 두 번 호출 하던 로직을 한번으로 줄이니 확실히 속도는 빨라지긴 했으나 

간헐적으로 뜨는 broken pipe 오류는 재현은 안되었기에 이후에도 오류가 나오면 쿼리 자체의 성능 개선을 진행해야겠다 :)